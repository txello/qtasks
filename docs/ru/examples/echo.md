# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è self –∏ self.ctx (echo=True)

–ü—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ `echo=True`, –∑–∞–¥–∞—á–∞ –ø–æ–ª—É—á–∞–µ—Ç –ø–µ—Ä–≤—ã–º –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º –æ–±—ä–µ–∫—Ç `self` —Ç–∏–ø–∞ `AsyncTask` –∏–ª–∏ `SyncTask`. –≠—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `self.ctx`, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –¥–∞–Ω–Ω—ã–º –∑–∞–¥–∞—á–∏ –∏ —É–ø—Ä–∞–≤–ª—è—é—â–∏–º –º–µ—Ç–æ–¥–∞–º.

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –ø—Ä–∏–º–µ—Ä –∑–∞–¥–∞—á–∏ —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π `self` –∏ `self.ctx`.

---

## üß© –ü—Ä–∏–º–µ—Ä –∑–∞–¥–∞—á–∏

```python
@app.task(
    echo=True, tags=["test"], priority=1,
    retry=3, retry_on_exc=[KeyError], decode=json.dumps,
    # generate_handler=yield_func, executor=MyTaskExecutor,
    # middlewares_before=[MyTaskMiddleware], middlewares_after=[MyTaskMiddleware],
    test="test"
)
async def test_echo_ctx(self: AsyncTask):
    # –ü–æ–ª—É—á–∞–µ–º –ª–æ–≥–≥–µ—Ä (—Å –∏–º–µ–Ω–µ–º –∑–∞–¥–∞—á–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    self.ctx.get_logger().info("–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞!")

    # –ü–∞—É–∑–∞ –≤ –∑–∞–¥–∞—á–µ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)
    await self.ctx.sleep(5)

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    self.ctx.get_logger().info(self.ctx.get_config())

    # –í—ã–≤–æ–¥ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–¥–∞—á–∏
    self.ctx.get_logger().info(
        f"""
            UUID: {self.ctx.task_uuid}
            –ò–º—è: {self.task_name}
            –¢–µ–≥–∏: {self.tags}
            –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {self.priority}
            –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: {self.extra}

            –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä: {self.retry}
            –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è –ø–æ–≤—Ç–æ—Ä–∞: {self.retry_on_exc}
            –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞: {self.ctx.generate_handler}

            –í—ã–∑–≤–∞–Ω –ª–∏ self: {self.echo}
            –î–µ–∫–æ—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä: {self.decode}

            TaskExecutor —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä: {self.executor}
            –ú–∏–¥–¥–ª–≤–∞—Ä–∏: {self.middlewares}
        """
    )

    # –û—Ç–º–µ–Ω–∞ –∑–∞–¥–∞—á–∏ –≤—Ä—É—á–Ω—É—é
    self.ctx.cancel("–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞")
    return "Hello, world!"
```

---

## üì¶ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ self

* `self.task_name`, `self.retry`, `self.tags`, `self.echo` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—á–∏
* `await self.add_task(...)` ‚Äî –∑–∞–ø—É—Å–∫ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
* `self.decode`, `self.executor`, `self.middlewares` ‚Äî –¥–æ—Å—Ç—É–ø –∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º –∑–∞–¥–∞—á–∏

---

## üß† –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ self.ctx

* `self.ctx.get_logger()` ‚Äî –ª–æ–≥–≥–µ—Ä —Å –∏–º–µ–Ω–µ–º –∑–∞–¥–∞—á–∏ –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–º –∏–º–µ–Ω–µ–º
* `self.ctx.sleep(seconds)` ‚Äî –∑–∞–¥–µ—Ä–∂–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* `self.ctx.cancel(reason)` ‚Äî –æ—Ç–º–µ–Ω–∞ –∑–∞–¥–∞—á–∏ —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `status=CANCEL`
* `self.ctx.get_config()`, `get_component(name)`, `get_task(uuid)`, `get_metadata()` ‚Äî –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—é

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–≥–∞—Ö

**–ö–ª–∏–µ–Ω—Ç:**

```
Task(status='cancel', uuid=..., task_name='test_echo_ctx', ..., cancel_reason='–¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞')
```

**–°–µ—Ä–≤–µ—Ä:**

```
2025-07-16 ... (test_echo_ctx) –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞!
...
UUID: ...
–ò–º—è: test_echo_ctx
–¢–µ–≥–∏: ['test']
...
–ó–∞–¥–∞—á–∞ ... –±—ã–ª–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –ø–æ –ø—Ä–∏—á–∏–Ω–µ: –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞
```

---

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `self` –∏ `self.ctx` –¥–µ–ª–∞–µ—Ç –∑–∞–¥–∞—á—É –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ—É–Ω–∫—Ü–∏–µ–π, –∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º, —Å–ø–æ—Å–æ–±–Ω—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π QTasks –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö.
